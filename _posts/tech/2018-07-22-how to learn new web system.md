---
layout: post
title: å¦‚ä½•æ¥æ‰‹ä¸€ä¸ªé¡¹ç›®å¹¶è¿›è¡Œæ–°åŠŸèƒ½å¼€å‘
category: æŠ€æœ¯
tags: [æ€»ç»“,å¼€å‘,å‰ç«¯,ä½“ç³»,å·¥ç¨‹åŒ–]
keywords: æ€»ç»“,å¼€å‘,å‰ç«¯,ä½“ç³»,å·¥ç¨‹åŒ–]
description: 
---

# å‰è¨€

å…¥èŒçš„ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯æ¥æ‰‹ä¸€ä¸ªæˆç†Ÿæ¶æ„çš„é¡¹ç›®ï¼Œç„¶åè¿›è¡Œæ–°åŠŸèƒ½çš„å¼€å‘ã€‚

ç³»ç»Ÿæ˜¯å¤§éƒ¨åˆ†å·²ç»å®Œæˆï¼Œéœ€è¦åšçš„æ˜¯å…ˆéªŒè¯ä¹‹å‰çš„ä»£ç æ˜¯å¦èƒ½æ­£å¸¸è¿è¡Œã€‚
ç„¶åäº†è§£æ•´ä¸ªé¡¹ç›®è®¾è®¡ï¼Œç†Ÿæ‚‰ä»£ç ã€‚å…ˆåˆæ­¥é˜…è¯»å‰ç«¯éƒ¨åˆ†ä»£ç ï¼Œå†NODEä¸­é—´å±‚ä»£ç ã€‚
è”é€šä¹‹åå†å»ç ”ç©¶ç»†èŠ‚æµç¨‹ã€‚
å†å°è¯•è¿è¡Œå¹¶å†™æ–°åŠŸèƒ½ã€‚
å†å†™æ–°åŠŸèƒ½ï¼Œè”è°ƒæµ‹è¯•ã€‚
æœ€åç³»ç»Ÿæµ‹è¯•ä¸Šçº¿ã€‚

# å‰ç«¯ä»£ç 

é¦–å…ˆäº†è§£ç›®å½•

â”œâ”€â”€ .csscomb.json 
â”œâ”€â”€ .git
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .tslintignore //å¿½ç•¥ä¸€äº›å†…å®¹
â”œâ”€â”€ README.md
â”œâ”€â”€ _client_src //å‰ç«¯ä»£ç 
â”œâ”€â”€ _server_src //nodeç«¯ä»£ç 
â”œâ”€â”€ common //å…¬å…±çš„å‡½æ•°
â”œâ”€â”€ config //ä¸€äº›é…ç½®
â”œâ”€â”€ node_modules
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json // ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ tsconfig.json //typescripté…ç½®
â””â”€â”€ tslint.json // typescirptæ ¼å¼éªŒè¯

è¿™é‡Œå”¯ä¸€ä¸ç†Ÿæ‚‰çš„æ˜¯ csscomb
æŸ¥äº†ä¸€ä¸‹

```

å®ƒå¯ä»¥å¸®åŠ©ä½ é‡æ–°æ’åºCSSä¸­å®šä¹‰çš„å±æ€§ï¼Œå¸®åŠ©ä½ æŒ‰ç…§ä½ é¢„å®šä¹‰çš„æ’åºæ ¼å¼ç”Ÿæˆæ–°çš„CSSã€‚ä¼šæŒ‰ç…§ä½ æƒ³è¦çš„æ ¼å¼å®šä¹‰ css ç©ºæ ¼ï¼Œæ¢è¡Œï¼Œç¼©è¿›ï¼Œä»£ç ç¼–å†™æ–¹å¼ã€‚

```

`.csscomb.json `å°±æ˜¯ä¸€ä¸ªcssçš„å†™æ³•è§„èŒƒå·¥å…·ã€‚

æ•´ä½“å¼€å‘è¿è¡Œéœ€è¦è·‘ä¸¤ä¸ªå‘½ä»¤ï¼Œåˆ†åˆ«ç”¨äºè·‘æœ¬åœ°Node serverç«¯ï¼Œå’Œå‰ç«¯é¡¹ç›®çš„çƒ­æ›´æ–°ã€‚
ä¹‹æ‰€ä»¥ä¸åˆåœ¨ä¸€èµ·æ˜¯å› ä¸ºå‰ç«¯çƒ­æ›´æ–°å°†æ¯”è¾ƒè€—æ—¶ï¼Œå¯¼è‡´nodeæœåŠ¡é‡æ–°å¯åŠ¨è¾ƒæ…¢ã€‚

# ä»å‰ç«¯ä»£ç å…¥æ‰‹

å‰ç«¯ä»£ç å¤„äº _client_src ç›®å½•
é¦–å…ˆå‰ç«¯é¡¹ç›®çš„æŠ€æœ¯æ ˆæ˜¯React15.6 + rxjs5.4 + typescript


â”œâ”€â”€ _WULIComponents // å…¬å…±ç»„ä»¶
â”œâ”€â”€ base.less // è®¾å®šå­—å·ï¼Œbodyåˆå§‹åŒ–
â”œâ”€â”€ entities // å®ä½“ç›®å½•ï¼Œé‡Œé¢åŒ…å«äº†ä¸€äº›é…ç½®ç”Ÿæˆå™¨ä¸é…ç½®åˆ—è¡¨
â”œâ”€â”€ index.d.ts // æ ‡è®°é¡¹ç›®é‡Œwindowå¯¹è±¡çš„ç±»å‹
â”œâ”€â”€ index.tsx // æ–‡ä»¶ä¸»å…¥å£ï¼ŒåŠ è½½äº†è·¯ç”±æ–‡ä»¶, åˆ¤æ–­äº†çƒ­æ›´æ–°ï¼Œå»ºç«‹äº†csrfé˜²å¾¡ã€‚åšäº†åŠ å¯†æªæ–½ã€‚
â”œâ”€â”€ node_modules // æ¨¡å—ä¾èµ–åŒ…
â”œâ”€â”€ pages // å‰ç«¯é¡µé¢
â”œâ”€â”€ routes // å‰ç«¯è·¯ç”±
â”œâ”€â”€ routes.tsx // è·¯ç”±è¯»å–å¹¶å¤„ç†
â”œâ”€â”€ tsconfig.json // typescripté…ç½®
â”œâ”€â”€ utils // å·¥å…·å‡½æ•°åº“
â””â”€â”€ vendor.tsx // å°†å…¬å…±çš„åº“åœ¨webpackåˆ†å¼€æ‰“åŒ…æ›´å¿«


ç›®å½•è¿™ä¹ˆå¤šï¼Œä»æ ¸å¿ƒæµç¨‹è¯»èµ·ã€‚

å¯åŠ¨ -> è½½å…¥è·¯ç”±é…ç½® -> è½½å…¥åŠŸèƒ½æ¨¡å—

ä» `index.tsx` æ–‡ä»¶ä¸­æœ€åæ˜¯å¼•å…¥äº†routes

åœ¨routesç›®å½•ä¸­

```
â”œâ”€â”€ admin_xxx.routes.tsx
...
â”œâ”€â”€ index.tsx
â”œâ”€â”€ login.routes.tsx
â”œâ”€â”€ product.routes.tsx
â”œâ”€â”€ routesSet.tsx
â””â”€â”€ welcome.routes.tsx

```


`routesSet.tsx`æ˜¯æœ€å…ˆå¼•å…¥çš„ï¼Œå®ƒé‡Œé¢åªæš´éœ²äº†ä¸€ä¸ªæ•°ç»„

```

export default [
  'login',
  'welcome',
  'admin_account',
  ...
  'product'
];

```

å¼•å…¥ä¹‹åï¼Œåšä¸€äº›å¤„ç†

```
import routesSet from './routesSet';

let childRoutes = [];
routesSet.forEach(element => {
  const route = require(`./${element}.routes`).default; // åŠ è½½åŒç›®å½•ä¸‹çš„å¯¹åº”è·¯ç”±é…ç½®
  childRoutes = childRoutes.concat(route); // å°†å…¶æ‹¼æ¥æˆä¸€ä¸ªæ•°ç»„
});

export const routes = childRoutes; // èµ‹å€¼ç»™routeså¹¶æš´éœ²å‡ºå»

const routeConfig = [{
  path: '/pages',
  component: App,
  exact: true, // å¦‚æœä¸ºtrueï¼Œåˆ™ä»…åœ¨è·¯å¾„ä¸location.pathnameå®Œå…¨åŒ¹é…æ—¶æ‰åŒ¹é…ã€‚
  childRoutes: [
    ...childRoutes,
    {name: 'Page not found', component: PageNotFound, path: '*'}
  ].filter(r => r['component'] || (r['childRoutes'] && r['childRoutes'].length > 0)) // è¿‡æ»¤æ‰ä¸åŒ¹é…æ ¼å¼çš„é¡¹
}]; // ç”Ÿäº§é…ç½®jsonï¼Œå…¶ä¸­æ¯ä¸ªè·¯ç”±é…ç½®è¿˜åªæ˜¯stringï¼Œéœ€è¦å¤„ç†

const handleIndexRoute = route => { 
  // å¤„ç†å­è·¯ç”±
  if (!route.childRoutes || !route.childRoutes.length) {
    return;
  }
  
  // æ‰¾åˆ°indexä¸ºtrueçš„å­è·¯ç”±
  const indexRoute = route.childRoutes.find(child => child.isIndex); 
  if (indexRoute) {
    const first = { ...indexRoute };
    first.path = route.path;
    first.exact = true;
    first.autoIndexRoute = true;
    route.childRoutes.unshift(first); // åœ¨å¯¹åº”è·¯ç”±ä¸‹çš„å­è·¯ç”±å‰ç«¯æ·»åŠ 
  }
  route.childRoutes.forEach(handleIndexRoute); // ç»§ç»­å‘å†…æ£€ç´¢
};

routeConfig.forEach(handleIndexRoute); // éå†æ¯ä¸€é¡¹è·¯ç”±çœ‹çœ‹æœ‰æ²¡æœ‰å­è·¯ç”±
export default routeConfig; // å°†å®Œæ•´çš„è·¯ç”±è¡¨æš´éœ²å‡ºå»


```

åœ¨çœ‹åŠŸèƒ½æ¨¡å—ä¹‹å‰éœ€è¦å¯¹åŸºç¡€å·¥å…·åº“åšä¸€äº›äº†è§£ã€‚

`utils`ç›®å½•ä¸‹æœ‰ä¸‰ä¸ªæ–‡ä»¶

```

â”œâ”€â”€ debug.tsx
â”œâ”€â”€ http.service.tsx
â””â”€â”€ tools.tsx

```

é‡ç‚¹å…³æ³¨`http.service.tsx` å› ä¸ºå®ƒæ˜¯å°è£…äº†ajaxæ•´ä¸ªæµç¨‹ã€‚

é€šè¿‡å¼•å…¥rxjsï¼Œå°†æ•´ä¸ªå¼‚æ­¥è¯·æ±‚ä»¥æµçš„å½¢å¼è¿›è¡Œæ§åˆ¶ã€‚

å› ä¸ºæµçš„å¼ºå¤§ï¼Œå› æ­¤åœ¨è¿‡ç¨‹ä¸­è¿˜å°†ä¸€äº›æç¤ºçš„uiä¹ŸåŠ å…¥è¿›æ¥ã€‚

æ¯”å¦‚

```

const success = [
 'background: green',
 'color: white',
 'display: block',
 'text-align: center'
].join(';');

const failure = [
 'background: red',
 'color: white',
 'display: block',
 'text-align: center'
].join(';');

```

å…³é”®çš„æ˜¯è¯·æ±‚æ“ä½œæ•°æ®

```

const fetchData = (method, url, data?, options?, errNotification = true) => new Promise((resolve, reject) => {
  let finalURL = url; 
  if (needQuery(method) && data) { // å¦‚æœéœ€è¦queryé‡Œçš„æ•°æ®
    const params = Object.keys(data)
      .filter(key => data[key] || data[key] === false)
      .map(key => encodeURIComponent(key) + '=' + encodeURIComponent(data[key]))
      .join('&')
      .replace(/%20/g, '+');
    finalURL = `${url}?${params}`; // æ‹¼æ¥æˆæœ€ç»ˆUrl
  }

  // æœ€ç»ˆbodyæ‹¼æ¥
  const finalOptions = Object.assign({}, {
    headers: {
      'Content-Type': 'application/json',
      'csrf-token': window['csrfToken'],
      'crypt-key': (window['crypt'] || {}).cryptkey
    },
    credentials: 'same-origin',
    method
  }, options);
  if (needBody(method)) {
    finalOptions.body = JSON.stringify(data);
  }
  // å‘é€è¯·æ±‚
  fetch(finalURL, finalOptions).then(response => {
    if (response.ok) {
      response.json().then(res => {
        if (res.errCode) {
          if (debuggerOn) {
            console.info(`%c ${finalOptions.method} ${finalURL} failed with res ${JSON.stringify(res)}!`, failure);
          }
          if (res.errCode === 401) {
            /** æˆæƒå¤±è´¥ */
            if (!has401Notification) {
              showErrNotification(`ç™»é™†è¿‡æœŸï¼Œæ­£åœ¨ä¸ºæ‚¨åˆ·æ–°ç•Œé¢`, `æ“ä½œå¤±è´¥`);
              has401Notification = true;
            }
            setTimeout(() => {
              window.location.href = `/pages/login`;
            }, 2000);
          } else {
            /** æ¥å£æŠ¥é”™ */
            errNotification && showErrNotification(`é”™è¯¯ä»£ç ï¼š${res.errCode}ï¼Œé”™è¯¯ä¿¡æ¯ï¼š${res.errMsg}`, 'æ“ä½œå¤±è´¥');
          }
          reject(res);
        } else {
          if (debuggerOn) {
            console.info(`%c ${finalOptions.method} ${finalURL} successful!`, success);
          }
          resolve(res.data);
        }
      });
    } else {
      if (debuggerOn) {
        console.info(`%c ${finalOptions.method} ${finalURL} failed!`, failure);
      }
      /** ç½‘ç»œè¿æ¥é”™è¯¯ */
      errNotification && showErrNotification(`ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡æ–°æ“ä½œ`);
      response.text().then(res => reject(res));
    }
  }).catch(err => {
    if (debuggerOn) {
      console.info(`%c ${finalOptions.method} ${finalURL} failed!`, failure);
    }
    /** å‰ç«¯é”™è¯¯ */
    errNotification && showErrNotification(`é”™è¯¯ä»£ç ï¼š00000ï¼Œè¯·è”ç³»ç®¡ç†å‘˜`, 'æ“ä½œå¤±è´¥');
    reject(err);
  });
});


```

ä¹‹åå°±æ˜¯é€šè¿‡

```

export const http = (method, url, data?, options?, errNotification?) => {
  return Observable.fromPromise<any>(fetchData(method, url, data, options, errNotification));
};

```

é€šè¿‡æš´éœ²httpæ–¹æ³•ï¼Œå°†fetchè¯·æ±‚çš„æ•´ä¸ªå¼‚æ­¥æµç¨‹å°è£…ã€‚

http å‡½æ•°å°±æ˜¯ä¸€ä¸ªæµï¼Œåªè¦è¢«è®¢é˜…ï¼Œå°±ä¼šæ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸”å°†è¯·æ±‚ç»“æœæˆ–è€…å¤±è´¥åŸå› ç”¨æµçš„å½¢å¼è¿”å›ã€‚

```

http('GET', '/user', {}, {}).subscribe(data => {
  console.log(data);
}, err => {
  console.log(err);
});

```


å½“å¤šæ¬¡å‘èµ·è¯·æ±‚ï¼ˆå¤šæ¬¡è®¢é˜…ï¼‰åä¼šå‘ç°ï¼Œæˆ‘ä»¬ä¹‹å‰çš„è®¢é˜…æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œé€ æˆäº†èµ„æºçš„æµªè´¹ã€‚æ‰€ä»¥æˆ‘ä»¬å®šä¹‰è‡ªå·±çš„ request å‡½æ•°å¦‚ä¸‹ï¼š

```

export const request = ({
  method, url, data, options, sucCallback, errCallback, errNotification
}: IRequestParams) => {
  const sub = http(method, url, data, options, errNotification).subscribe(data => {
    sucCallback(data);
    sub.unsubscribe();
  }, err => {
    errCallback(err);
    sub.unsubscribe();
  });
};

```


> Observable.fromPromise å°† Promise è½¬åŒ–ä¸º Observableã€‚å¦‚æœ Promise resolves ä¸€ä¸ªå€¼, è¾“å‡º Observable å‘å‡ºè¿™ä¸ªå€¼ç„¶åå®Œæˆã€‚ å¦‚æœ Promise è¢« rejected, è¾“å‡º Observable ä¼šå‘å‡ºç›¸åº”çš„ é”™è¯¯ã€‚

äº†è§£äº†è¯·æ±‚æ˜¯å¦‚æœå‘å‡ºçš„ï¼Œç»§ç»­äº†è§£å¦‚ä½•å¤„ç†ç¼“å­˜è¿™äº›æ•°æ®ã€‚

åœ¨ä»¥å¾€éƒ½æ˜¯åˆ©ç”¨reduxè¿™ç±»çš„åº“æ¥å¸®åŠ©ç®¡ç†æ•°æ®ã€‚

Rxjsè‡ªå¸¦äº†æµç‰¹æ€§ï¼Œè®©ç»„ä»¶è®¢é˜… Rxjs çš„æµï¼Œå¹¶ä¸”åœ¨æµæ›´æ–°çš„æ—¶å€™åˆ·æ–°ç•Œé¢,å¯ä»¥å®ç°å•é¡¹æ•°æ®æµã€‚
ç”¨ BehaviorSubject è¿™ä¸ªç±»æ¥ä½œä¸ºå­˜å‚¨çš„æ•°æ®æµï¼Œå› ä¸ºå®ƒèƒ½å®ç°æ•°æ®å…±äº«ã€‚

å› ä¸ºæ˜¯ä»¿reduxçš„ä¸€ç³»åˆ—æ€æƒ³å†™çš„ç”Ÿæˆå™¨ï¼Œå› æ­¤å¾ˆå¤šåœ°æ–¹éƒ½å‚ç…§å¯¹åº”æ ¼å¼ã€‚

`entities`ç›®å½•ä¸‹:

```

â”œâ”€â”€ _common
â”œâ”€â”€ account
â”œâ”€â”€ auth
â”œâ”€â”€ dictionary
â”œâ”€â”€ entity_generator.tsx // å…³é”®çš„ç”Ÿæˆå™¨ 
â”œâ”€â”€ feedback
â”œâ”€â”€ permission
â”œâ”€â”€ product
â”œâ”€â”€ role
â””â”€â”€ view

```

ç”Ÿæˆå™¨çš„æºç ï¼š

```

// å®šä¹‰åŠ¨ä½œç±»å‹ã€‚æ›´ä¸»è¦æ˜¯å¼‚æ­¥åŠ¨ä½œï¼Œæ¯”å¦‚httpè¯·æ±‚

export const actionTypes = {
  CUSTOM: 'custom',
  DATA: 'data',
  VALUE_DATA: 'valueData',
  BOOL_DATA: 'boolData',
  ACTION: 'action',
  ASYNC_ACTION: 'asyncAction'
};

export default (entityName: string, configs: IConfigs) => {
  const result: any = {};

  /** every entity has a common actionLoading */
  // å…±åŒçš„ loading åˆå§‹åŒ–ä¸ºfalse
  const actionLoading$ = new BehaviorSubject(false).debug(`[${entityName}]:[actionLoading]`); // 
  result.actionLoading$ = actionLoading$;
  // éå†æ¯ä¸ªé…ç½®
  configs.forEach(config => {
    const {
      /** common */
      type, name, custom,

      /** data, valueData, boolData */
      init,

      /** boolData */
      privateName,

      /** action */
      handler,

      /** asyncAction */
      privateLoading, actionLoading, confirmLoading, bindLoading,
      requestOpts, filter, data, pagination
    } = config;

    // å¯¹æ¯ä¸ªåŠ¨ä½œçš„ç±»å‹è¿›è¡Œåˆ¤æ–­æ“ä½œï¼Œåˆ›å»ºå¯¹åº”çš„BehaviorSubject
    switch (config.type) {
      case actionTypes.CUSTOM:
        // å¦‚æœæ˜¯custom,è¯´æ˜æ˜¯è®©ç”¨æˆ·è‡ªå®šä¹‰æµ
        result[`${name}$`] = custom(result).debug(`[${entityName}]:[${name}]`);
        break;
      case actionTypes.DATA:
        /** create data Observable */
        
        result[`${name}$`] = new BehaviorSubject(init || false).debug(`[${entityName}]:[${name}]`);
        break;

      case actionTypes.VALUE_DATA:
        /** create data Observable */
        result[`${name}$`] = new BehaviorSubject(init || 0).debug(`[${entityName}]:[${name}]`);

        /** set data operation */
        // æ›´æ–°å¯¹åº”BehaviorSubjectçš„å½“å‰å€¼
        result[`set${toCamel(name)}`] = params => {
          result[`${name}$`].next(params);
        };
        break;

      case actionTypes.BOOL_DATA:
        /** create data Observable. If privateName is true, it'll use ${name} to be the name */
        if (privateName) {
          result[`${name}$`] = new BehaviorSubject(init || false).debug(`[${entityName}]:[${name}]`);
        } else {
          result[`${name}Show$`] = new BehaviorSubject(init || false).debug(`[${entityName}]:[${name}Show]`);
        }

        /** private loadingï¼Œyou can emit data wherever you need */
        if (privateLoading) {
          result[`${name}Loading$`] = new BehaviorSubject(false).debug(`[${entityName}]:[${name}Loading]`);
        }

        /** show operation */
        result[`show${toCamel(name)}`] = () => {
          if (privateName) {
            result[`${name}$`].next(true);
          } else {
            result[`${name}Show$`].next(true);
          }
        };

        /** hide operation */
        result[`hide${toCamel(name)}`] = () => {
          if (privateName) {
            result[`${name}$`].next(false);
          } else {
            result[`${name}Show$`].next(false);
          }
        };
        break;

      case actionTypes.ACTION:
        /** create operation */
        result[`${name}`] = params => {
          handler(params, result);
        };
        break;

      /** async action */
      case actionTypes.ASYNC_ACTION:

        /** private loadingï¼Œauto emit data in async operation */
        if (privateLoading) {
          result[`${name}Loading$`] = new BehaviorSubject(false).debug(`[${entityName}]:[${name}Loading]`);
        }

        /** create data Observableï¼Œauto emit data when request success */
        // åˆ›å»ºæ•°æ®æµï¼Œæ¯å½“å®ƒè¯·æ±‚æˆåŠŸéƒ½è‡ªåŠ¨å‘é€æ•°æ®
        if (data) {
          result[`${name}Data$`] = new BehaviorSubject(data.init).debug(`[${entityName}]:[${name}Data]`);
          result[`set${toCamel(name)}Data`] = data => {
            result[`${name}Data$`].next(data);
          };
          result[`merge${toCamel(name)}Data`] = (key, data) => {
            result[`${name}Data$`].next(
              Object.assign({}, result[`${name}Data$`].value, { [key]: data })
            );
          };
        }

       ã€‚ã€‚ã€‚
       
       
   return result;
};

```

ç”Ÿæˆå™¨ä¸»è¦åˆå§‹åŒ–äº†ä¸€äº›åŠ¨ä½œBehaviorSubjectï¼Œæ ¹æ®å¯¹åº”å‡ºå‘æ¡ä»¶è®©å…¶å‘é€æ•°æ®æˆ–è€…æ›´æ–°å½“å‰æ•°æ®ã€‚
ç­‰åŒäºreduxçš„actionä¸reducerç»“åˆä½“ã€‚

é‡æ–°å›é¡¾
`entities`ç›®å½•ä¸‹:

```

â”œâ”€â”€ _common //å…¬å…±æ¨¡å—ï¼ŒåŒ…æ‹¬loadingã€toastæ˜¾ç¤ºéšè—ï¼Œé¡µé¢jump
â”œâ”€â”€ account 
â”œâ”€â”€ auth
â”œâ”€â”€ dictionary
â”œâ”€â”€ entity_generator.tsx // å…³é”®çš„ç”Ÿæˆå™¨ 
â”œâ”€â”€ feedback
â”œâ”€â”€ permission
â”œâ”€â”€ product
â”œâ”€â”€ role
â””â”€â”€ view

```

`account`ç›®å½•ä¸‹ä¸‰ä¸ªæ–‡ä»¶

```
â”œâ”€â”€ account.constants.tsx
â”œâ”€â”€ account.entity.tsx
â””â”€â”€ index.tsx
```

`index.tsx`ä»£ç å¦‚ä¸‹ï¼š

```

import generator from '../entity_generator'; // è½½å…¥ç”Ÿæˆå™¨

const ENTITY_NAME = 'account'; // å®ä½“åç§°
const entities = ['account']; // å®ä½“ç»„åˆ

const result: any = {};
entities.forEach(item => {
  const entity = require(`./${item}.entity`).default; // å¼•å…¥æ¯ä¸ªå¯¹åº”å®ä½“é…ç½®
  Object.assign(result, generator(ENTITY_NAME, entity)); // é€šè¿‡å®ä½“ç”Ÿæˆå™¨å°†å¯¹åº”æµåˆå§‹åŒ–
});

export default result;

```

æŸ¥çœ‹å¯¹åº”`account.entity.tsx`çš„å†…å®¹ï¼š

```

export default [
  {
    type: actionTypes.ASYNC_ACTION,
    name: 'accountList',
    // ç§æœ‰çš„loadingï¼Œåœ¨æ¯æ¬¡å¼‚æ­¥è¯·æ±‚æ—¶è‡ªåŠ¨å‘é€æ•°æ®
    privateLoading: true,
    // è¯·æ±‚å‚æ•°
    requestOpts: {
      method: 'GET',
      url: (params, entity) => `/apis/account`,
      data: (params, entity) => Object.assign({},
        wrapFilterData(entity[`accountListFilterData$`].getValue()), {
          limit: entity[`accountListPageSize$`].getValue(),
          offset: (entity[`accountListCurPage$`].getValue() - 1) * entity[`accountListPageSize$`].getValue() || '0'
        }, wrapFilterData(params))
    },
    filter: {
      init: {}
    },
    pagination: {
      pageSize: 10,
      total: (params, response, entity) => response.count
    },
    data: {
      init: [],
      handler: (params, response, entity) => response.userList
    }
  }
  ã€‚ã€‚ã€‚
];

```

è¿™ä¸ªæ–‡ä»¶ä¸“é—¨ç»´æŠ¤åŠ¨ä½œçš„é…ç½®è¡¨ï¼Œæ¯å½“éœ€è¦æ–°çš„åŠŸèƒ½/åŠ¨ä½œï¼Œå°±æ ¹æ®çº¦å®šå†™å¥½å¯¹åº”çš„é…ç½®å³å¯ã€‚

`account.constants.tsx` ç»´æŠ¤äº†ä¸€å †å¸¸é‡ã€‚

`entities`çš„å…¶å®ƒç›®å½•é‡Œçš„å†…å®¹éƒ½ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œéœ€è¦ç»“åˆåŠŸèƒ½æ¨¡å—æ¥ç†è§£ï¼Œ

æ¯”å¦‚å­ç›®å½•ä¸‹çš„`view`å°±æ¯”è¾ƒå¤æ‚ï¼Ÿï¼Ÿï¼Ÿ

`pages`ç›®å½•ä¸»è¦åŒ…å«äº†æ‰€æœ‰é¡µé¢ã€‚

```

â”œâ”€â”€ AdminAccount
â”œâ”€â”€ AdminDictionary
â”œâ”€â”€ AdminPermission
â”œâ”€â”€ AdminRole
â”œâ”€â”€ AdminView
â”œâ”€â”€ App
â”œâ”€â”€ FavoriteFeedBack
â”œâ”€â”€ FeedBackInfo
â”œâ”€â”€ Login
â”œâ”€â”€ PageNotFound
â”œâ”€â”€ Product
â”œâ”€â”€ ProductInfo
â”œâ”€â”€ ProductMy
â”œâ”€â”€ ProductSetting
â”œâ”€â”€ Welcome
â””â”€â”€ _common

```

é¦–å…ˆéœ€è¦äº†è§£å…¬å…±æ¨¡å—`_common`é‡Œéƒ½æœ‰ä»€ä¹ˆå†…å®¹:

```

â”œâ”€â”€ components
|  â””â”€â”€ ProductList  //å°è£…äº†ä¸€ä¸ªå•†å“è¯¦æƒ…çš„å…¬å…±ç»„ä»¶ã€‚
â”œâ”€â”€ decorators
|  â”œâ”€â”€ injectSubs.decorator.ts // è¯»å–é…ç½®ä¸­éœ€è¦è½½å…¥çš„è®¢é˜…æºå¹¶æ‰‹å·¥è®¢é˜…ï¼Œåœ¨ç»„ä»¶ä»€ä¹ˆå‘¨æœŸç»“æŸåå–æ¶ˆè®¢é˜…ã€‚
è¿™é‡Œæ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå› æ­¤éœ€è¦åœ¨å†…å¤–ä¸¤ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé‡Œéƒ½è¿›è¡Œè®¢é˜…æ“ä½œï¼Œå› æ­¤åŠ å…¥äº†mixinLifecycleEvents,å…ˆè®¢é˜…æ•°æ®æºï¼Œå†æ‰§è¡Œå„ä¸ªè®¢é˜…æ“ä½œã€‚
|  â”œâ”€â”€ observer.decorator.tsx // ç®¡ç†çš„æ•°æ®çš„æ‰¹é‡è®¢é˜…ä¸å–æ¶ˆè®¢é˜…
|  â””â”€â”€ saveRouterProps.decorator.tsx // å®ç°äº†ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œç”¨äºå°†è·¯ç”±é‡Œçš„å‚æ•°è¿›è¡Œä¿å­˜
â”œâ”€â”€ selectors
|  â””â”€â”€ common.selector.tsx // å¼•å…¥äº†ä¹‹å‰çš„commonå®ä½“ï¼Œå°†ä¸€äº›å¼¹æ¡†ç±»å‹çš„åŠ¨ä½œè¿›è¡Œäº†å°è£…ã€‚
â””â”€â”€ utils.tsx // å®ç°äº†ä¸€äº›æŸ¥è¯¢å‡½æ•°ä¸æƒé™åˆ¤å®šå‡½æ•°ã€‚

```

`utils.tsx`çš„ä»£ç å¦‚ä¸‹ï¼š

```

const {
  currentTab$
} = view;

export const getLatestDataByProductId = (target: any) => {
  return Observable.combineLatest(target, currentTab$,
    (targets, currentTab: IcurrentTab) => targets[(currentTab.params || {}).productId]
  );
};

export const getLatestDataByFeedbackId = (target: any) => {
  return Observable.combineLatest(target, currentTab$,
    (targets, currentTab: IcurrentTab) => targets[(currentTab.params || {}).feedbackId]
  );
};

export const displayActionByAuthority = (wrap: any, code: string) => {
  const currentValue = view.currentTab$.getValue();
  if (!currentValue.hasOwnProperty('params')) {
    return '';
  }
  const { productId } = currentValue.params;
  const productRole = product.productActionData$.getValue();
  const IsDisplay = (productRole[productId] || []).includes(code);
  return IsDisplay ? wrap : '';
};

export const IsAuthority = (code: string) => {
  const currentValue = view.currentTab$.getValue();
  if (!currentValue.hasOwnProperty('params')) {
    return false;
  }
  const { productId } = currentValue.params;
  const productRole = product.productActionData$.getValue();
  const IsDisplay = (productRole[productId] || []).includes(code);
  return IsDisplay;
};

```


äº†è§£ä¹‹åéœ€è¦å®šä½åˆ°`App`ï¼Œç¨‹åºå…¥å£ï¼Œçœ‹çœ‹éƒ½åšäº†å“ªäº›åŠ¨ä½œ

```

â”œâ”€â”€ containers // ç»„ä»¶åŒ–
|  â”œâ”€â”€ Confirm
|  â”œâ”€â”€ Content
|  â”œâ”€â”€ Footer
|  â”œâ”€â”€ Header
|  â”œâ”€â”€ Notification
|  â”œâ”€â”€ ResetPsdModal
|  â””â”€â”€ Sider
â”œâ”€â”€ index.tsx // å…¥å£æ–‡ä»¶
â””â”€â”€ style.less

```

`index.tsx`æºç :

```

import * as React from 'react';
import './style';

import { getValue, jsonParse, getQuery } from 'tools';
import auth from 'e_auth'; // å¼•å…¥æƒé™æ ¡éªŒå®ä½“
import view from 'e_view';
import common from 'e_common';

import Header from './containers/Header';
import Footer from './containers/Footer';
import Sider from './containers/Sider';
import Content from './containers/Content';
import Notification from './containers/Notification';
import Confirm from './containers/Confirm';
import ResetPsdModal from './containers/ResetPsdModal';

/** æ˜¯å¦éœ€è¦è¿˜åŸç”¨æˆ· tab æ•°æ® */
const NEED_RESTORE_TAB_INFO = true;

class App extends React.PureComponent<IProps, IStates> {

  componentDidMount() {
    common.hideNotification();
    common.hideToast();

    this.init();
  }

  init = () => {
    if (getValue('userInfo')) {
      const userInfo = jsonParse(getValue('userInfo'));
      auth.setUserInfo(jsonParse(getValue('userInfo')));

      /** è·å–å­˜å‚¨çš„ç”¨æˆ· tab æ•°æ® */
      const id = userInfo.id;
      const restoreTabs = (jsonParse(getValue('restoreTabs')) || {})[id];
      const restoreCurrentTab = (jsonParse(getValue('restoreCurrentTab')) || {})[id] || {};

      if (restoreTabs && NEED_RESTORE_TAB_INFO) {
        view.setTabs(restoreTabs);
        view.switchTab(restoreCurrentTab.mapping ? restoreCurrentTab : restoreTabs[0]);
      }

      this.setSystemListAndLoadViewList(restoreTabs);
    }
  }

  /** è®¾ç½®ç³»ç»Ÿåˆ—è¡¨ï¼Œè·å–ç³»ç»Ÿçš„å¯è§è§†å›¾åˆ—è¡¨ï¼Œå¹¶åŠ è½½å·²å­˜å‚¨ tab çš„æ¨¡å—å’ŒæŒ‰é’®æƒé™ */
  setSystemListAndLoadViewList = restoreTabs => {
    if (getValue('systemList') && !(window.location.pathname === '/pages/login')) {
      auth.setSystemList(jsonParse(getValue('systemList')));
      /** åªæœ‰ä¸€ä¸ªç³»ç»Ÿçš„æƒ…å†µ */
      view.viewList({
        code: jsonParse(getValue('systemList'))[0].code,
        sucCallback: (params, res) => {
          if (restoreTabs && NEED_RESTORE_TAB_INFO) {
            restoreTabs.forEach(tab => {
              if (this.isInViewList(res.viewList, tab.id)) {
                view.viewPermissionList({ id: tab.id });
              }
            });
          }
        }
      });
    }
  }

  /** åˆ¤æ–­ä¸€ä¸ª tab æ˜¯å¦å±äºå¯è§è§†å›¾åˆ—è¡¨ */
  isInViewList = (viewList, id) => {
    const finalViewList = [];
    const pushToViewList = view => {
      finalViewList.push(view.id);
      view.viewViewTreeSet.forEach(item => pushToViewList(item));
    };
    pushToViewList(viewList[0]);
    return finalViewList.includes(id);
  }

  isLoginPage = () => {
    return location.pathname === '/pages/login';
  }

  render() {
    return (
      <div className="app-layout">
        <div className="header-layout">
          <Header />
        </div>
        <div className="container">
          <div className={`container-layout w100 ${this.isLoginPage() ? '' : 'mw'}`}>
            <div className="sider-layout">
              <Sider />
            </div>
            <div className="content-layout">
              {this.isLoginPage() ? this.props.children : <Content />}
            </div>
          </div>
        </div>
        <div className="footer-layout">
          <Footer />
        </div>
        <Notification />
        <Confirm />
        <ResetPsdModal />
      </div>
    );
  }
}

interface IProps {
  location: {
    search: string;
  }
}
interface IStates { }

export default App;

```

é¦–é¡µæ˜¯æ ¹æ®ç™»å½•åä»æœåŠ¡ç«¯æ‹¿åˆ°çš„ç³»ç»Ÿåˆ—è¡¨ï¼Œæ ¹æ®æƒé™ç­‰ä¿¡æ¯ï¼Œä»ç¼“å­˜ä¸­è¯»å–å­˜å‚¨çš„tabsæ•°æ®ï¼Œå†é€šè¿‡`view`çš„å®ä½“æµæ¥å‘èµ·UIæ›´æ–°ã€‚


## éœ€è¦äº†è§£æ›´æ·±å…¥çš„å…¶ä»–æµç¨‹

### æ•´ä¸ªç™»å½•é€€å‡ºçš„æµç¨‹ï¼ŒåŒ…æ‹¬è·¯ç”±çš„çŠ¶æ€

æ•´ä¸ªç™»å½•é€€å‡ºçš„æ ¸å¿ƒæµç¨‹åŒ…æ‹¬ï¼š

1. ç”¨æˆ·è®¿é—®é¡µé¢ï¼Œæœªç™»å½•æƒ…å†µè·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚
2. è¾“å…¥è´¦å·å¯†ç ï¼ŒéªŒè¯ã€‚
3. ç™»å½•æˆåŠŸè·³è½¬ã€‚
4. ç‚¹å‡»é€€å‡ºï¼Œè·³è½¬å›ç™»å½•é¡µé¢ã€‚

ç¬¬ä¸€æ­¥çš„è·³è½¬æ˜¯éœ€è¦åšæœåŠ¡ç«¯éªŒè¯çš„ï¼Œå› æ­¤è·¯ç”±çš„æ§åˆ¶åœ¨Nodeå±‚çš„`page/controller`
å®ƒå…ˆè¿›è¡Œèº«ä»½çš„æ ¡éªŒï¼Œå¦‚æœä¸ç¬¦åˆç›´æ¥é‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼Œé™„å¸¦ä¸Šç™»å½•å‰çš„æ¥æºã€‚

```

if (needToken && !isExist) {
    return ctx.redirect(`/pages/login?next=${encodeURIComponent(ctx.originalUrl)}`);
  }

```

ç¬¬äºŒæ­¥åˆ†ä¸¤å—ï¼Œå½“ç”¨æˆ·è¾“å…¥ä¹‹åï¼Œé¡µé¢ä¼šåšç®€å•çš„æ ¡éªŒï¼Œè¿™éƒ¨åˆ†ä»£ç æ˜¯å†™åœ¨`pages/Login`

è¯¥ç›®å½•çš„ç»“æ„å¦‚ä¸‹:

```

â”œâ”€â”€ containers
|  â””â”€â”€ LoginForm
|     â”œâ”€â”€ LoginForm.component.tsx // é…ç½®æç¤ºé¡¹ï¼Œç™»å½•UIç•Œé¢
|     â”œâ”€â”€ LoginForm.decorator.tsx // é«˜é˜¶ç»„ä»¶ï¼Œåœ¨componentDidMountä¸­åˆå§‹åŒ–è®¢é˜…ç™»å½•æµã€‚åœ¨componentWillUnmountä¸­å–æ¶ˆè®¢é˜…ã€‚
|     â”œâ”€â”€ LoginForm.selector.tsx //  ç™»å½•åŠ è½½æµçš„é…ç½®
|     â”œâ”€â”€ index.tsx // å°†decoratorä¸componentç»„åˆæš´éœ²
|     â””â”€â”€ style.less
â”œâ”€â”€ index.tsx // ä¸»è¦æ˜¯åŠ è½½LoginFormç»„ä»¶
â””â”€â”€ style.less

```

åœ¨ `LoginForm.decorator.tsx` ä¸­ï¼Œè°ƒç”¨äº†auth entityçš„loginæ¥å£ã€‚
åœ¨ auth éªŒè¯ç™»å½•æˆåŠŸåï¼Œå°†åå°ä¼ æ¥çš„å…³äºèœå•çš„æƒé™åˆ—è¡¨å†™åˆ°æœ¬åœ°çš„ `userinfo` å’Œ `systemlist`,æ¥ç€è¿”å›çš„æ•°æ®ä¼ ç»™å¯¹åº”æµã€‚ç„¶åå†å»æ ¡éªŒè§†å›¾ID

```
     sucCallback: (params, res, entity) => {
        /** ç™»é™†åè®¾ç½®ç”¨æˆ·ä¿¡æ¯å’Œç³»ç»Ÿåˆ—è¡¨ */
        setValue('userInfo', JSON.stringify(res.account));
        setValue('systemList', JSON.stringify(res.systemList));
        entity['userInfo$'].next(res.account);
        entity['systemList$'].next(res.systemList);
        view.viewList({
          code: res.systemList[0].code
        });
      }
      
```

å½“æˆåŠŸè·³è½¬åˆ° `App` å¯¹åº”çš„è·¯ç”±ï¼Œè€Œä¸”å·²ç»æœ‰ç™»å½•æ ‡å¿—çš„æƒ…å†µä¸‹ï¼Œ`App`ä¹‹å‰ç¼“å­˜çš„`userinfo` å’Œ `systemlist` åˆ†åˆ«è¯»å‡ºæ¥ï¼Œå¹¶ä¸”æ ¹æ®é…ç½®æ¸²æŸ“å¯¹åº”çš„UIã€‚

å½“ç”¨æˆ·ç‚¹å‡»é€€å‡ºçš„æ—¶å€™ã€‚è§¦å‘`auth`çš„logoutï¼Œè¿™é‡Œå‰ç«¯å°±ç›´æ¥è·³è½¬åˆ°äº†`login`é¡µé¢ï¼Œæ¥ç€å°†é¡µé¢çš„`tabs`éƒ½æ¸…ç©ºï¼Œåˆ é™¤æœ¬åœ°ç¼“å­˜çš„`restoreTabs`ä¸`restoreCurrentTab`ã€‚æœ¬åœ°ä¿å­˜ç€ä¸¤ä¸ªæ˜¯ä¸ºäº†è®©ç”¨æˆ·åˆ·æ–°çš„æ—¶å€™è¿˜èƒ½å¤Ÿå®šä½åˆ°åŸå…ˆä¹‹å‰çš„æ“ä½œä½ç½®ã€‚
æœ€åæ˜¯è¿˜åŸ`currentTab`ä¸ºé…ç½®åˆå§‹åŒ–çš„å€¼ï¼Œè®©ä¸‹æ¬¡ç™»å½•çš„æ—¶å€™æ˜¯æœ€åˆçš„æ¬¢è¿é¡µé¢ã€‚

è·¯ç”±çš„æ§åˆ¶å¯ä»¥ä»æ•´ä¸ªæµç¨‹çœ‹åˆ°ï¼Œåªæœ‰åœ¨æœªæˆæƒçš„æƒ…å†µä¸‹æ˜¯æ ¹æ®äº†NodeæœåŠ¡å™¨è¿”å›çš„é‡å®šå‘ï¼Œå…¶ä»–æˆæƒçš„è·³è½¬æ“ä½œéƒ½æ˜¯å‰ç«¯æ¥æ§åˆ¶çš„ã€‚
ä¹Ÿå°±æ˜¯åœ¨æ¯ä¸ªæœ‰å¼‚æ­¥äº¤äº’åŠ¨ä½œæ‰§è¡Œçš„æˆåŠŸï¼Œéƒ½ç»å†äº†æƒé™çš„æ ¡éªŒã€‚


### åŠŸèƒ½æ¨¡å—çš„tabsé€‰æ‹©ï¼Œåˆ é™¤ï¼Œç‚¹å‡»å·²å­˜åœ¨æ›´æ–°çŠ¶æ€ï¼Œç‚¹å‡»æ–°çš„åˆ›å»ºã€‚

è¿™ä¸ªäº¤äº’æ˜¯åšäº†å¾ˆç»†çš„é¢—ç²’åº¦å¤„ç†ã€‚
åŒ…æ‹¬æ¯æ¬¡ç‚¹å‡»éƒ½å°†ç”¨æˆ·çš„æ“ä½œå­˜åˆ°`localstorage`
ç„¶åè®©å„ä¸ªæµéƒ½æ›´æ–°æ•°æ®ï¼Œè®©UIä¹Ÿéšä¹‹æ›´æ–°ã€‚

å…¶ä¸­æ¶‰åŠå®ä½“ä¸­`view`é‡Œçš„é…ç½®:

```

 { // å½“å‰é€‰æ‹©çš„ï¼Œå±•ç¤ºä¸­çš„viewï¼Œéç¼–è¾‘ä¸­çš„view
    type: actionTypes.VALUE_DATA,
    name: 'editView',
    init: {}
  },
  {
    type: actionTypes.VALUE_DATA,
    name: 'editingView',
    init: {}
  },
  { // å½“ç¼–è¾‘ä¸­çš„viewï¼Œç¼–è¾‘çŠ¶æ€ä¸‹ï¼šä¸é€‰ä¸­çš„editViewæ˜¯åŒä¸€ä¸ªï¼Œå¢åŠ å­è§†å›¾çŠ¶æ€ï¼šparentId ä¸ºeditView.id
    type: actionTypes.BOOL_DATA,
    name: 'viewEditModal',
    privateLoading: true
  },
  
```

ä»¥åŠåœ¨`App`çš„UIæ›´æ–°

```

if (getValue('userInfo')) {
      const userInfo = jsonParse(getValue('userInfo'));
      auth.setUserInfo(jsonParse(getValue('userInfo')));

      /** è·å–å­˜å‚¨çš„ç”¨æˆ· tab æ•°æ® */
      const id = userInfo.id;
      const restoreTabs = (jsonParse(getValue('restoreTabs')) || {})[id];
      const restoreCurrentTab = (jsonParse(getValue('restoreCurrentTab')) || {})[id] || {};

      if (restoreTabs && NEED_RESTORE_TAB_INFO) {
        view.setTabs(restoreTabs);
        view.switchTab(restoreCurrentTab.mapping ? restoreCurrentTab : restoreTabs[0]);
      }

      this.setSystemListAndLoadViewList(restoreTabs);
    }

```


### å†™ä¸€ä¸ªæ–°åŠŸèƒ½é¡µé¢éœ€è¦æ›´æ”¹å‡ å¤„å†…å®¹

1. è·¯ç”±åŒ¹é…
   éœ€è¦åœ¨å‰ç«¯è·¯ç”±ä¸­å°†è·¯ç”±é…ç½®å†™æ˜ã€‚å‘½åè¦å’Œçº¦å®šä¸€è‡´ã€‚

2. é¡µé¢å†…å®¹
   åœ¨`pages`å»ºç«‹å¯¹åº”ç»„ä»¶ç›®å½•ï¼Œç»“æ„å¦‚ä¸‹ï¼š
   
   ```
   
    â”œâ”€â”€ Xxx.component.tsx
    â”œâ”€â”€ Xxx.decorator.tsx
    â”œâ”€â”€ Xxx.selector.tsx
    â”œâ”€â”€ index.tsx
    â””â”€â”€ style.less
       
   ```

3. æ•°æ®ç®¡ç†

   æ ¹æ®éœ€è¦çš„æµæ•°æ®ï¼Œå†™å¥½é…ç½®ï¼Œåœ¨`entities`ä¸­å»ºç«‹å¯¹åº”ç›®å½•ï¼Œç»“æ„å¦‚ä¸‹:
   
   ```

    â”œâ”€â”€ xxx.constants.tsx
    â”œâ”€â”€ xxx.entity.tsx
    â””â”€â”€ index.tsx
   
   ```

4. åå°äº¤äº’

   åœ¨serverç«¯å†™å…¥å¯¹åº”çš„`apis`


ä»¥ä¸Šé¡ºåºæ˜¯ä¸ä¸€å®šçš„ï¼Œéƒ½è¦†ç›–å³å¯ã€‚

ä¸¾ä¸ªğŸŒ°

åœ¨ä¸ªäººä¸­å¿ƒåŠ å…¥ä¸€ä¸ªé€šçŸ¥é…ç½®çš„åŠŸèƒ½ã€‚å› ä¸ºæ˜¯åœ¨åŒä¸ªèœå•ä¸­çš„åŠŸèƒ½ï¼Œå› æ­¤ç…§æŠ„ä¹‹å‰çš„ä¿®æ”¹ä¿¡æ¯çš„å†™æ³•ã€‚

```

     items: [
          {
            key: 'resetpsd',
            title: 'ä¿®æ”¹å¯†ç '
          },
          {
            key: 'notifyconfig',
            title: 'é€šçŸ¥é…ç½®'
          }
        ]

```

æ‰¾åˆ°å¯¹åº”`modal`è§¦å‘çš„åœ°æ–¹ã€‚æ˜¯`auth`é‡Œçš„æ•°æ®æµæ§åˆ¶çš„ï¼Œå› æ­¤åœ¨å¯¹åº”çš„é…ç½®é‡ŒåŠ å…¥ã€‚

```

 case 'resetpsd':
          auth.showResetPsdModal();
          break;
        case 'notifyconfig':
          auth.showNotifyConfigModal();
          break;

```

ä¹‹åæ‰¾åˆ°å¯¹åº”`resetPsd`ç»„ä»¶,ç»“æ„å¦‚ä¸‹:

```

â”œâ”€â”€ Notification.component.tsx
â”œâ”€â”€ Notification.decorator.tsx
â”œâ”€â”€ Notification.selector.tsx
â”œâ”€â”€ index.tsx
â””â”€â”€ style.less

```

å»ºç«‹å¯¹åº”çš„`notifyConfig`ç»„ä»¶,ä¿®æ”¹é€»è¾‘ä¸å¯¹æ¥æ¥å£ï¼Œå¹¶å°†å…¶å¼•å…¥åˆ°`App/index.tsx`



## Nodeä»£ç 

nodeä¸­é—´å±‚çš„ç»“æ„æ¯”è¾ƒç†Ÿæ‚‰ã€‚
è¿˜æ˜¯koa2 + typescriptçš„ç»„åˆã€‚
ç›®å½•å¦‚ä¸‹:

```

â”œâ”€â”€ index.js
â”œâ”€â”€ index.ts
â”œâ”€â”€ node_modules
â”œâ”€â”€ portal
â”œâ”€â”€ public
â”œâ”€â”€ routes
â”œâ”€â”€ views
â”œâ”€â”€ webpack.dev.server.js
â”œâ”€â”€ webpack.dev.server.ts
â”œâ”€â”€ webpack.mobile.server.js
â””â”€â”€ webpack.mobile.server.ts

```

åœ¨tsè¿˜æ— æ³•ç›´æ¥è¿è¡Œçš„æƒ…å†µä¸‹ï¼ŒåŸºæœ¬è¿˜æ˜¯é€šè¿‡webpackè¿›è¡Œè½¬ç æˆjsæ ¼å¼ï¼Œç„¶åå†è¿è¡Œã€‚

`index.ts`ä¸­è¿˜æ˜¯koaçš„å¸¸è§å†™æ³•ï¼Œé€šè¿‡å¤–éƒ¨å®šä¹‰å„ç§ä¸­é—´ä»¶ï¼Œç„¶åé€ä¸ªå¼•ç”¨ï¼Œæœ€åç›‘å¬ã€‚

è¿™é‡Œåšäº†æ¯”è¾ƒå¤šçš„æ“ä½œçš„æ˜¯è·¯ç”±è¿™éƒ¨åˆ†ã€‚

`routes`ä¹Ÿåˆ†ä¸º `apis` å’Œ `pages`. 

åœ¨`apis`ä¸­ï¼Œä¸»è¦æ˜¯æ ¹æ®æ¨¡å—åŒºåˆ†äº†ä¸åŒçš„é…ç½®åˆ—è¡¨ï¼Œå†é€šè¿‡æ ¹ç›®å½•ä¸‹çš„`common`ä¸­çš„`api_generator`æ¥å®Œæˆé…ç½®é¡¹åˆ°çœŸå®APIæ˜ å°„ã€‚

`api_generator` ä¸»è¦åšäº†è¿™ä¹ˆå‡ ä»¶äº‹æƒ…:

1. è·å–äº†ä¼ é€’æ¥çš„apisåˆ—è¡¨ï¼Œå¹¶éå†ã€‚
2. å°†å…¶å°è£…æˆå‡½æ•°åˆ°è·¯ç”±åºåˆ—ä¸­ã€‚å…¶ä¸­ä¹Ÿçº¦å®šäº†æ¥å£è°ƒç”¨çš„é¡ºåºä¸­éœ€è¦æ‰§è¡Œå“ªäº›åˆ¤æ–­ã€‚

`pages` ä¸»è¦é€»è¾‘åœ¨`controller.ts`, å®ƒå°†å‡ ä¸ªå¸¸è§å…¥å£ï¼ˆPCç«¯ï¼Œmobileç«¯ï¼‰åšäº†é€»è¾‘å¤„ç†ï¼Œå¹¶è¿›è¡Œå¯¹åº”çš„é‡å®šå‘è·³è½¬ã€‚




## ç»“å°¾

å…¶å®åœ¨ç†Ÿæ‚‰æ ¸å¿ƒæµç¨‹ä»¥åŠå¦‚ä½•é…ç½®åå°±å¯ä»¥ç€æ‰‹å¼€å‘äº†ï¼Œä¸è¿‡éœ€è¦å…ˆè¯•éªŒæ¥é€šä¸€ä¸ªå°åŠŸèƒ½ä»å‰ç«¯åˆ°nodeå±‚çš„åŠŸèƒ½ï¼Œç„¶åå†ä¸€æ­¥æ­¥æ‰©å±•å³å¯ã€‚


